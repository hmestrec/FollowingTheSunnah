<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Editor</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-amplify/4.3.13/aws-amplify.min.js"></script>
    <style>
        body {
            display: none; /* Hide the body until authenticated */
        }
    </style>
</head>
<body>

    <header>
        <h1>Document Editor</h1>
    </header>

    <main>
        <div class="toolbar">
            <button onclick="execCmd('bold')">Bold</button>
            <button onclick="execCmd('italic')">Italic</button>
            <button onclick="execCmd('underline')">Underline</button>
            <button onclick="execCmd('justifyLeft')">Left Align</button>
            <button onclick="execCmd('justifyCenter')">Center Align</button>
            <button onclick="execCmd('justifyRight')">Right Align</button>
        </div>

        <div id="editor" contenteditable="true">
            <p>Edit your content here...</p>
        </div>
    </main>

    <script>
        console.log("Starting script...");

        // Amplify Configuration
        Amplify.configure({
            Auth: {
                region: 'us-east-1', // Your region
                userPoolId: 'us-east-1_jcjKwG4JA', // Your Cognito User Pool ID
                userPoolWebClientId: '38bb82epf2rmhpvbnhck7uoa6b', // Your Cognito App Client ID
                oauth: {
                    domain: 'followingsunnahlogin.auth.us-east-1.amazoncognito.com',
                    scope: ['email', 'openid', 'aws.cognito.signin.user.admin'],
                    redirectSignIn: 'https://followingsunnah.net/editing.html',
                    redirectSignOut: 'https://followingsunnah.net/',
                    responseType: 'code'
                }
            }
        });

        console.log("Amplify configured...");

        // Check if the user is authenticated
        async function checkAuth() {
            console.log("Checking authentication...");
            try {
                const user = await Amplify.Auth.currentAuthenticatedUser();
                console.log('User is authenticated:', user);
                document.body.style.display = 'block'; // Show content
            } catch (error) {
                console.error('Error in authentication check:', error);
                console.log('No user is authenticated, redirecting to login.');
                window.location.href = 'https://followingsunnahlogin.auth.us-east-1.amazoncognito.com/login?client_id=38bb82epf2rmhpvbnhck7uoa6b&response_type=code&scope=aws.cognito.signin.user.admin&redirect_uri=https%3A%2F%2Ffollowingsunnah.net%2Fediting.html';
            }
        }

        // Run the authentication check when the page loads
        window.onload = function() {
            console.log('Window loaded. Running checkAuth...');
            checkAuth();
        };

        // Execute command for editor formatting
        function execCmd(command) {
            document.execCommand(command, false, null);
        }
    </script>

</body>
</html>
